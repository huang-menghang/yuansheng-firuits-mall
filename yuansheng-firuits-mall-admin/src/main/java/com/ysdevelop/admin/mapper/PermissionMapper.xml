<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ysdevelop.admin.mapper.PermissionDao">
<select id="listPermissionById" resultType="com.ysdevelop.admin.entity.Permission">
select `p`.`id`,`p`.`permissionName`,`p`.`permissionLevel`,`p`.`permissionDescription`
from `t_ys_firuits_permission` as `p`
right join `t_ys_firuits_role_permission` as `rp`
on `p`.id = `rp`.`permissionId`
where `rp`.`roleId` = #{id} 
</select>

<select id="listPermission" resultType="com.ysdevelop.admin.entity.Permission">
select `id`,`permissionName`,`permissionLevel`,`permissionDescription`
from `t_ys_firuits_permission` 
where `parentId` != -1
</select>


<select id="listPermissionRoleNotHave" resultType="com.ysdevelop.admin.entity.Permission">
select `id`,`permissionName`,`permissionLevel`,`permissionDescription`
from `t_ys_firuits_permission`
<where>
<choose>
<when test="roleHave != null and roleHave != '' and roleHave.size()>0">
id not in 
<foreach collection="roleHave" item="rolePermission" separator="," open="(" close=")" index="">
#{rolePermission.id}
</foreach>
</when>
<otherwise>1</otherwise>
</choose>
and `parentId` != -1
</where>
</select>

<select id="listPermissionByParentId" resultType="com.ysdevelop.admin.entity.Permission">
select `id`,`permissionName`,`permissionLevel`,`permissionDescription`
from `t_ys_firuits_permission`
where `parentId`=#{parentId} 
</select>

<select id="countByQueryMap" resultType="java.lang.Integer" >
   SELECT
   count(p.id)
   FROM  t_ys_firuits_permission  as  p 
   WHERE 1=1
   <if test="queryMap.permissionName != null and queryMap.permissionName != 'null' and queryMap.permissionName != ''">
   and
    p.permissionName like CONCAT('%',#{queryMap.permissionName},'%')
   </if>
   <if test="queryMap.permissionUrl != null and queryMap.permissionUrl !=  'null'  and queryMap.permissionUrl != ''   ">
   and
    p.permissionUrl like CONCAT('%',#{queryMap.permissionUrl},'%')
   </if>
   <if test="queryMap.userParentId != null and queryMap.userParentId !=  'null'  and queryMap.userParentId != ''   ">
   and 
    p.parentId = #{queryMap.userParentId}
   </if>
   <if test="queryMap.status != null and queryMap.status !=  'null'  and queryMap.status != ''   ">
   and 
    p.status = #{queryMap.status}
   </if>
   <if test="queryMap.permissionHref != null and queryMap.permissionHref !=  'null'  and queryMap.permissionHref != ''   ">
   and
    p.permissionHref like CONCAT('%',#{queryMap.permissionHref},'%')
   </if>
   <if test="queryMap.permissionLevel != null and queryMap.permissionLevel !=  'null'  and queryMap.permissionLevel != ''   ">
   and 
    p.permissionLevel = #{queryMap.permissionLevel}
   </if>
   <if test="queryMap.permissionDescription != null and queryMap.permissionDescription !=  'null'  and queryMap.permissionDescription != ''  ">
   and
    p.permissionDescription like CONCAT('%',#{queryMap.permissionDescription},'%')
   </if>
   <if test="queryMap.status != null and queryMap.status != 'null' and queryMap.status != '' ">
   and
   `p`.status = #{queryMap.status}
   </if>
   <if test="queryMap.startTime != null and queryMap.startTime !=  'null'   and queryMap.startTime != ''   ">
   and  <![CDATA[  p.createTime  >= #{queryMap.startTime} ]]>
   </if>
   <if test="queryMap.endTime != null and queryMap.endTime !=  'null'   and queryMap.endTime != ''   ">
   and  <![CDATA[  p.createTime  <= #{queryMap.endTime} ]]>
   </if>
   </select>
   
   <select id="paginationByQueryMap" resultType="com.ysdevelop.admin.entity.Permission">
      select
       p.id as  id,
       p.permissionName as  permissionName,
       p.permissionUrl as  permissionUrl,
       p.parentId as  parentId,
       p.permissionHref as  permissionHref,
       p.permissionLevel as  permissionLevel,
       p.permissionDescription as  permissionDescription,
       p.createTime as  createTime,   
       p.updateTime as  updateTime,
       p.status as status
      from  t_ys_firuits_permission  as  p 
      where 1=1
     
   <if test="queryMap.permissionName != null and queryMap.permissionName !=  'null'  and queryMap.permissionName != ''   ">
   and
    p.permissionName like CONCAT('%',#{queryMap.permissionName},'%')
   </if>
   <if test="queryMap.permissionUrl != null and queryMap.permissionUrl !=  'null'  and queryMap.permissionUrl !=  ''  ">
   and
    p.permissionUrl like CONCAT('%',#{queryMap.permissionUrl},'%')
   </if>
   <if test="queryMap.userParentId != null and queryMap.userParentId !=  'null'  and queryMap.userParentId != ''   ">
   and 
    p.parentId = #{queryMap.userParentId}
   </if>
   <if test="queryMap.status != null and queryMap.status !=  'null'  and queryMap.status != ''   ">
   and 
    p.status = #{queryMap.status}
   </if>
   <if test="queryMap.permissionHref != null and queryMap.permissionHref !=  'null'  and queryMap.permissionHref != ''  ">
   and
    p.permissionHref like CONCAT('%',#{queryMap.permissionHref},'%')
   </if>
   <if test="queryMap.permissionLevel != null and queryMap.permissionLevel !=  'null'  and queryMap.permissionLevel != ''   ">
   and 
    p.permissionLevel = #{queryMap.permissionLevel}
   </if>
   <if test="queryMap.permissionDescription != null and queryMap.permissionDescription !=  'null'  and queryMap.permissionDescription != ''   ">
   and
    p.permissionDescription like CONCAT('%',#{queryMap.permissionDescription},'%')
   </if>
   <if test="queryMap.status != null and queryMap.status != 'null' and queryMap.status != '' ">
   and
   p.status = #{queryMap.status}
   </if>
   <if test="queryMap.createTime != null and queryMap.createTime !=  'null'   and queryMap.createTime != ''   ">
   and  <![CDATA[  p.createTime  >= #{queryMap.startTime} ]]>
   </if>
   <if test="queryMap.endTime != null and queryMap.endTime !=  'null'   and queryMap.endTime !=  ''  ">
   and  <![CDATA[  p.createTime  <= #{queryMap.endTime} ]]>
   </if>
   order by p.createTime  desc
   limit #{pagination.start},#{pagination.pageSize}
   </select>
   
   <delete id="deleteBatchByIds">
   delete from t_ys_firuits_permission
   where id in
   <foreach collection="list" item="id" separator="," open="(" close=")" index="">
   #{id}
   </foreach>
   </delete>
   
   <update id="updateStatusById">
		update t_ys_firuits_permission 
		set status = case
		when
		status = 0 then
		1
		when status = 1 then
		0
		else
		status
		end
		where
		id =
		#{id}
	</update>
	
	<select id="getInfoById" resultType="com.ysdevelop.admin.entity.Permission">
	  SELECT
	  permissionName,
	  permissionUrl,
	  parentId,
	  permissionHref,
	  permissionLevel,
	  permissionDescription
	  FROM t_ys_firuits_permission 
	  where id = #{id}
	</select>
	
	<update id="editById" >
	update
	t_ys_firuits_permission
	<if test="queryMap.permissionName != null and queryMap.permissionName != 'null' and queryMap.permissionName != ''">
	<set>
	permissionName = #{queryMap.permissionName}
	</set>
	</if>
	<if test="queryMap.permissionUrl != null and queryMap.permissionUrl !=  'null'  and queryMap.permissionUrl != ''   ">
	<set>
	permissionUrl = #{queryMap.permissionUrl}
	</set>
	</if>
	<if test="queryMap.userParentId != null and queryMap.userParentId !=  'null'  and queryMap.userParentId != ''   ">
	<set>
	parentId = #{queryMap.userParentId}
	</set>
	</if>
	<if test="queryMap.permissionHref != null and queryMap.permissionHref !=  'null'  and queryMap.permissionHref != ''   ">
	<set>
	permissionHref = #{queryMap.permissionHref}
	</set>
	</if>
	<if test="queryMap.permissionLevel != null and queryMap.permissionLevel !=  'null'  and queryMap.permissionLevel != ''   ">
	<set>
	permissionLevel = #{queryMap.permissionLevel}
	</set>
	</if>
	<if test="queryMap.permissionDescription != null and queryMap.permissionDescription !=  'null'  and queryMap.permissionDescription != ''  ">
	<set>
	permissionDescription = #{queryMap.permissionDescription}
	</set>
	</if>
	where 
	id = #{id}
	</update>
	
	<insert id="insertItem">
	insert into
	t_ys_firuits_permission (permissionName,permissionUrl,parentId,permissionHref,permissionLevel,permissionDescription,createTime,updateTime,status)
	values(#{queryMap.userPermissionName},#{queryMap.userPermissionUrl},#{queryMap.parentId},#{queryMap.userPermissionHref},#{queryMap.userPermissionLevel},#{queryMap.userPermissionDescription},#{queryMap.createTime},#{queryMap.updateTime},#{queryMap.status})
	</insert>
</mapper>
